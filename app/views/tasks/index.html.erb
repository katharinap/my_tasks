<div class="card-group">
    <div class="card">
	<div class="card-body">
	    <div id="new-task" class="form-group">
		<%= form_with(model: @task) do |f| %>
		    <%= f.collection_select :category_id, @categories.sort_by(&:name), :id, :name, {}, class: "form-control form-control-sm" %>
		    <%= f.text_field :description, class: "form-control form-control-sm", placeholder: "Description" %>
		    <%= f.number_field :duration_in_hours, class: "form-control form-control-sm", placeholder: "Duration (in hours)" %>
		    <%= f.date_field :date, class: "form-control form-control-sm" %>
		    <%= f.submit 'Add Task', class: 'btn btn-outline-primary btn-sm mt-1' %>
		<% end %>
	    </div>
	</div>
    </div>
    <div class="card">
	<div class="card-body">
	    <div id="new-category" class="form-group">
		<%= form_with(model: @category) do |f| %>
		    <%= f.text_field :name, class: "form-control form-control-sm", placeholder: "Name" %>
		    <%= f.submit 'Add Category', class: 'btn btn-outline-primary btn-sm mt-1' %>
		<% end %>
	    </div>
	</div>
    </div>
</div>

<!-- create one card-group per week?, or two plus summary? -->
<% @tasks.sort_by(&:date).reverse.group_by(&:date).each do |date, tasks| %>
    <div class="card">
	<div class="card-title">
	    <div class="row">
		<div class="col-2">
		    <h5><%= date.strftime "%a, %B %d %Y" %></h5>
		</div>
		<div class="col-4">
		    <% pensum = Task.relative_day_pensum(tasks) %>
		    <div class="progress">
			<div class="progress-bar progress-bar-striped <%= 'bg-success' unless pensum < 100 %>" role="progressbar" style="width: <%= pensum %>%" aria-valuenow="<%= pensum %>" aria-valuemin="0" aria-valuemax="100">
			    <%= pensum %>%
			</div>
		    </div>
		</div>
	    </div>
	</div>
	<div class="card-body">
	    <ul id="tasks-<%= date.as_json %>">
		<%= render tasks %>
	    </ul>
	</div>
    </div>
<% end %>


